<div id="visitor-counter" class="visitor-counter-inline" title="Page views">
  <span class="visitor-count-badge">
    <svg class="visitor-icon" viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
      <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
    </svg>
    <span id="visitor-count" class="visitor-number">â€¦</span>
  </span>
</div>

<style>
  .visitor-counter-inline {
    display: inline-block;
    margin-left: 1rem;
  }
  
  .visitor-count-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.4rem 0.7rem;
    background-color: #f0f0f0;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    color: #666;
    transition: all 0.3s ease;
    cursor: default;
  }
  
  .visitor-count-badge:hover {
    background-color: #e8e8e8;
    color: #333;
  }
  
  .visitor-icon {
    opacity: 0.8;
    animation: pulse-subtle 2s infinite;
  }
  
  .visitor-number {
    font-size: 0.9rem;
    font-weight: 700;
    min-width: 2rem;
    text-align: center;
  }
  
  @keyframes pulse-subtle {
    0%, 100% {
      opacity: 0.8;
    }
    50% {
      opacity: 0.5;
    }
  }
  
  @media (max-width: 480px) {
    .visitor-counter-inline {
      margin-left: 0.5rem;
    }
    
    .visitor-count-badge {
      padding: 0.3rem 0.5rem;
      font-size: 0.75rem;
    }
    
    .visitor-icon {
      width: 16px;
      height: 16px;
    }
  }
</style>

<script>
// Self-hosted visitor counter using Cloudflare Worker for real-time increments.
(function(){
  try {
    var el = document.getElementById('visitor-count');
    if (!el) return;
    
    // First, display the current count from Jekyll's data
    var count = {{ site.data.visitor_count.count | default: 0 }};
    if (count && typeof count === 'number') {
      el.textContent = count.toLocaleString();
    } else {
      el.textContent = '0';
    }
    
    // Then, asynchronously increment the counter via Cloudflare Worker
    (function incrementCounter() {
      // Only increment once per session to avoid duplicates on page reload
      if (sessionStorage.getItem('visitor-counted')) {
        return;
      }
      
      // Replace with your actual Cloudflare Worker URL
      var workerUrl = 'https://your-worker-subdomain.workers.dev/increment';
      
      fetch(workerUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      })
      .then(function(res) { return res.json(); })
      .then(function(data) {
        if (data.count) {
          // Update display with new count from server
          el.textContent = data.count.toLocaleString();
          sessionStorage.setItem('visitor-counted', 'true');
        }
      })
      .catch(function(err) {
        console.warn('Visitor counter update failed:', err);
        // Fail silently - don't disrupt user experience
      });
    })();
    
  } catch (e) {
    /* fail silently */
  }
})();
</script>
